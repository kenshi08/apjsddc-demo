formatVersion: 1
name: basic-cloudinit
version: 1.3
inputs: 
  os:
    title: Operating System
    description: This value controls the operating system to which your server will be based on
    type: string
    enum:
      - ubuntu1804
      - ubuntu1604
      - centos7
    default: ubuntu1604
  size:
    title: Size of the server
    description: This value controls the size of the server
    type: string
    enum:
      - small
      - medium
      - large
    default: small
  count:
    type: integer
    default: 1
    maximum: 5
    minimum: 1
    title: No. of instances
  platform:
    title: Platform
    description: This value controls the platform of choice
    type: string
    enum:
      - aws
      - vsphere
      - azure
      - gcp
    default: aws
  environment:
    type: string
    description: Environment
    default: test
    enum:
      - dev
      - test
      - prod
  sshkey:
    type: string
    description: Instance SSH Key
    default: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDhkqyKhmvntyo5Tn/VDLExWxpiwZDBN1L9JH5Hz38zYZHsOVwggIPZ8705nDMY6xbROcVFXJnA6xoApdvR16D2Nb7F8z6qbxZcigIzYnHv73uRTr5vm7GBi2/sIrJLJvWTXVCF/X4NAyAloOWOu/V8iUao5rMQ5JaiPNsLAfbdkEnhTP8e5VKpnoWDuOq5VyISk9qOKhjAgKXz/fs7F2XHjmor4ahWx1bge/ZYnGqNCNZMAVogbgsiwuOZ9gDMyhFUd6Quq06RXQEBi1s8Cm/HENHlhlTKtaxM7ViMqlMBHdOcCM94mSOMR46IwI9he03Wyd3B0phSZMw0h5t7a3XD
    encrypted: true
    readonly: true
resources:
  basic-iaas:
    type: Cloud.Machine
    properties:
      tags:
        - value: owner
          key: '${env.requestedBy}'
      image: ubuntu1604
      flavor: small
      constraints:
        - tag: 'platform:aws'
        - tag: 'env:test'
      networks:
        - network: '${resource.demo-net.id}'
      cloudConfig: |
        # log all cloud-init process output (info & errors) to a logfile
        output: {all: ">> /var/log/cloud-init-output.log"}
        repo_update: true
        repo_upgrade: all
        package_update: true
        packages:
        â€“ python
        users:
          - name: apjdemo
            ssh-authorized-keys:
            - ${input.sshkey}
            sudo: ['ALL=(ALL) NOPASSWD:ALL']
            groups: sudo
            shell: /bin/bash
  demo-net:
    type: Cloud.Network
    properties:
      name: demo-net
      networkType: existing
      constraints:
        - tag: 'function:mgmt'
